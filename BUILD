# -*- python -*-
# This file contains rules for Bazel; see https://bazel.io/ .

load("//:tools/third_party/kythe/tools/build_rules/lexyacc.bzl", "genlex", "genyacc")

genyacc(
    name = "parser",
    srcs = ["src/parser/parser.yc"],
    outs = [
        "src/parser/parser.tab.cc",
        "src/parser/parser.tab.hh",
    ],
)

genlex(
    name = "lexer",
    srcs = [
        "src/parser/lexer.l",
        ":parser",
    ],
    out = "lexer.lex.cc",
)

IBEX_SRCS = [
    "src/ibex_Setting.h",
    "src/arithmetic/ibex_Dim.cpp",
    "src/arithmetic/ibex_DoubleIndex.cpp",
    "src/arithmetic/ibex_InnerArith.cpp",
    "src/arithmetic/ibex_Interval.cpp",
    "src/arithmetic/ibex_IntervalMatrix.cpp",
    "src/arithmetic/ibex_IntervalVector.cpp",
    "src/arithmetic/ibex_Matrix.cpp",
    "src/arithmetic/ibex_SetMembership.cpp",
    "src/arithmetic/ibex_Vector.cpp",
    "src/bisector/ibex_Bsc.cpp",
    "src/bisector/ibex_LargestFirst.cpp",
    "src/bisector/ibex_RoundRobin.cpp",
    "src/bisector/ibex_SmearFunction.cpp",
    "src/combinatorial/ibex_QInter.cpp",
    "src/contractor/ibex_Ctc.cpp",
    "src/contractor/ibex_Ctc3BCid.cpp",
    "src/contractor/ibex_CtcAcid.cpp",
    "src/contractor/ibex_CtcCompo.cpp",
    "src/contractor/ibex_CtcEmpty.cpp",
    "src/contractor/ibex_CtcExist.cpp",
    "src/contractor/ibex_CtcFixPoint.cpp",
    "src/contractor/ibex_CtcForAll.cpp",
    "src/contractor/ibex_CtcFwdBwd.cpp",
    "src/contractor/ibex_CtcHC4.cpp",
    "src/contractor/ibex_CtcIdentity.cpp",
    "src/contractor/ibex_CtcInteger.cpp",
    "src/contractor/ibex_CtcInverse.cpp",
    "src/contractor/ibex_CtcNewton.cpp",
    "src/contractor/ibex_CtcNotIn.cpp",
    "src/contractor/ibex_CtcPropag.cpp",
    "src/contractor/ibex_CtcQInter.cpp",
    "src/contractor/ibex_CtcQuantif.cpp",
    "src/contractor/ibex_CtcUnion.cpp",
    "src/function/ibex_CompiledFunction.cpp",
    "src/function/ibex_Eval.cpp",
    "src/function/ibex_ExprDomain.cpp",
    "src/function/ibex_Function.cpp",
    "src/function/ibex_Gradient.cpp",
    "src/function/ibex_HC4Revise.cpp",
    "src/function/ibex_InHC4Revise.cpp",
    "src/function/ibex_NumConstraint.cpp",
    "src/function/ibex_VarSet.cpp",
    "src/numeric/ibex_Linear.cpp",
    "src/numeric/ibex_Newton.cpp",
    "src/parser/ibex_CtrGenerator.cpp",
    "src/parser/ibex_MainGenerator.cpp",
    "src/parser/ibex_P_Expr.cpp",
    "src/parser/ibex_P_ExprGenerator.cpp",
    "src/parser/ibex_P_ExprPrinter.cpp",
    "src/parser/ibex_P_NumConstraint.cpp",
    "src/parser/ibex_P_Source.cpp",
    "src/parser/ibex_Scope.cpp",
    "src/parser/ibex_SyntaxError.cpp",
    "src/predicate/ibex_PdcAnd.cpp",
    "src/predicate/ibex_PdcCleared.cpp",
    "src/predicate/ibex_PdcDiameterLT.cpp",
    "src/predicate/ibex_PdcFirstOrder.cpp",
    "src/predicate/ibex_PdcFwdBwd.cpp",
    "src/predicate/ibex_PdcHansenFeasibility.cpp",
    "src/predicate/ibex_PdcImageSubset.cpp",
    "src/predicate/ibex_PdcNo.cpp",
    "src/predicate/ibex_PdcNot.cpp",
    "src/predicate/ibex_PdcOr.cpp",
    "src/predicate/ibex_PdcYes.cpp",
    "src/set/ibex_Sep.cpp",
    "src/set/ibex_SepBoundaryCtc.cpp",
    "src/set/ibex_SepCtcPair.cpp",
    "src/set/ibex_SepFwdBwd.cpp",
    "src/set/ibex_SepInter.cpp",
    "src/set/ibex_SepInverse.cpp",
    "src/set/ibex_SepNot.cpp",
    "src/set/ibex_SepQInter.cpp",
    "src/set/ibex_SepUnion.cpp",
    "src/set/ibex_Set.cpp",
    "src/set/ibex_SetBisect.cpp",
    "src/set/ibex_SetInterval.cpp",
    "src/set/ibex_SetLeaf.cpp",
    "src/set/ibex_SetNode.cpp",
    "src/set/ibex_SetValueNode.cpp",
    "src/strategy/ibex_Backtrackable.cpp",
    "src/strategy/ibex_Cell.cpp",
    "src/strategy/ibex_CellBuffer.cpp",
    "src/strategy/ibex_CellStack.cpp",
    "src/strategy/ibex_EntailedCtr.cpp",
    "src/strategy/ibex_Paver.cpp",
    "src/strategy/ibex_SetImage.cpp",
    "src/strategy/ibex_Solver.cpp",
    "src/strategy/ibex_SubPaving.cpp",
    "src/symbolic/ibex_CmpOp.cpp",
    "src/symbolic/ibex_Expr.cpp",
    "src/symbolic/ibex_Expr2DAG.cpp",
    "src/symbolic/ibex_Expr2Minibex.cpp",
    "src/symbolic/ibex_ExprCmp.cpp",
    "src/symbolic/ibex_ExprCopy.cpp",
    "src/symbolic/ibex_ExprDiff.cpp",
    "src/symbolic/ibex_ExprPrinter.cpp",
    "src/symbolic/ibex_ExprSimplify.cpp",
    "src/symbolic/ibex_ExprSize.cpp",
    "src/symbolic/ibex_ExprSubNodes.cpp",
    "src/system/ibex_ExtendedSystem.cpp",
    "src/system/ibex_FritzJohnCond.cpp",
    "src/system/ibex_NormalizedSystem.cpp",
    "src/system/ibex_System.cpp",
    "src/system/ibex_SystemFactory.cpp",
    "src/tools/ibex_Agenda.cpp",
    "src/tools/ibex_DirectedHyperGraph.cpp",
    "src/tools/ibex_Exception.cpp",
    "src/tools/ibex_HyperGraph.cpp",
    "src/tools/ibex_Random.cpp",
    "src/tools/ibex_String.cpp",
    "src/tools/ibex_Timer.cpp",
    ":lexer",
    ":parser",
]

IBEX_HDRS = [
    # This file is generated as a by-product of ibex's waf build.
    "src/ibex.h",
    # TODO(soonhok): these .cpp_ files are added here just because
    # bazel doesn't allow .cpp_ extension. Need to either find a
    # workaround in bazel or rename them to have an allowed extension.
    "src/arithmetic/ibex_Interval_bias.cpp_",
    "src/arithmetic/ibex_Interval_direct.cpp_",
    "src/arithmetic/ibex_Interval_filib.cpp_",
    "src/arithmetic/ibex_Interval_gaol.cpp_",
    "src/function/ibex_FunctionBuild.cpp_",
    "src/parser/parser.cpp_",
    "src/set/ibex_SetConnectedComponents.cpp_",
    "src/system/ibex_FritzJohnFactory.cpp_",
    "src/system/ibex_SystemCopy.cpp_",
    "src/system/ibex_SystemExtend.cpp_",
    "src/system/ibex_SystemMerge.cpp_",
    # TODO(soonhok): these .h_ files are added here just because bazel
    # doesn't allow .h_ extension. Need to either find a workaround in
    # bazel or rename them to have an allowed extension.
    "src/arithmetic/ibex_Interval_bias.h_",
    "src/arithmetic/ibex_Interval_direct.h_",
    "src/arithmetic/ibex_Interval_filib.h_",
    "src/arithmetic/ibex_Interval_gaol.h_",
    "src/arithmetic/ibex_LinearArith.h_",
    "src/arithmetic/ibex_TemplateMatrix.h_",
    "src/arithmetic/ibex_TemplateVector.h_",
    ################################################################
    "src/arithmetic/ibex_Dim.h",
    "src/arithmetic/ibex_Domain.h",
    "src/arithmetic/ibex_DoubleIndex.h",
    "src/arithmetic/ibex_InnerArith.h",
    "src/arithmetic/ibex_Interval.h",
    "src/arithmetic/ibex_IntervalMatrix.h",
    "src/arithmetic/ibex_IntervalVector.h",
    "src/arithmetic/ibex_InvalidIntervalVectorOp.h",
    "src/arithmetic/ibex_Matrix.h",
    "src/arithmetic/ibex_TemplateDomain.h",
    "src/arithmetic/ibex_Vector.h",
    "src/bisector/ibex_Bsc.h",
    "src/bisector/ibex_LargestFirst.h",
    "src/bisector/ibex_NoBisectableVariableException.h",
    "src/bisector/ibex_RoundRobin.h",
    "src/bisector/ibex_SmearFunction.h",
    "src/combinatorial/ibex_QInter.h",
    "src/contractor/ibex_Ctc.h",
    "src/contractor/ibex_Ctc3BCid.h",
    "src/contractor/ibex_CtcAcid.h",
    "src/contractor/ibex_CtcCompo.h",
    "src/contractor/ibex_CtcEmpty.h",
    "src/contractor/ibex_CtcExist.h",
    "src/contractor/ibex_CtcFixPoint.h",
    "src/contractor/ibex_CtcForAll.h",
    "src/contractor/ibex_CtcFwdBwd.h",
    "src/contractor/ibex_CtcHC4.h",
    "src/contractor/ibex_CtcIdentity.h",
    "src/contractor/ibex_CtcInteger.h",
    "src/contractor/ibex_CtcInverse.h",
    "src/contractor/ibex_CtcNewton.h",
    "src/contractor/ibex_CtcNotIn.h",
    "src/contractor/ibex_CtcPropag.h",
    "src/contractor/ibex_CtcQInter.h",
    "src/contractor/ibex_CtcQuantif.h",
    "src/contractor/ibex_CtcUnion.h",
    "src/function/ibex_BwdAlgorithm.h",
    "src/function/ibex_CompiledFunction.h",
    "src/function/ibex_Eval.h",
    "src/function/ibex_ExprData.h",
    "src/function/ibex_ExprDomain.h",
    "src/function/ibex_Function.h",
    "src/function/ibex_FwdAlgorithm.h",
    "src/function/ibex_Gradient.h",
    "src/function/ibex_HC4Revise.h",
    "src/function/ibex_InHC4Revise.h",
    "src/function/ibex_NumConstraint.h",
    "src/function/ibex_VarSet.h",
    "src/numeric/ibex_Linear.h",
    "src/numeric/ibex_LinearException.h",
    "src/numeric/ibex_Newton.h",
    "src/parser/ibex_CtrGenerator.h",
    "src/parser/ibex_MainGenerator.h",
    "src/parser/ibex_P_Expr.h",
    "src/parser/ibex_P_ExprGenerator.h",
    "src/parser/ibex_P_ExprPrinter.h",
    "src/parser/ibex_P_ExprVisitor.h",
    "src/parser/ibex_P_NumConstraint.h",
    "src/parser/ibex_P_Source.h",
    "src/parser/ibex_Scope.h",
    "src/parser/ibex_SyntaxError.h",
    "src/parser/ibex_UnknownFileException.h",
    "src/predicate/ibex_BoolInterval.h",
    "src/predicate/ibex_Pdc.h",
    "src/predicate/ibex_PdcAnd.h",
    "src/predicate/ibex_PdcCleared.h",
    "src/predicate/ibex_PdcDiameterLT.h",
    "src/predicate/ibex_PdcFirstOrder.h",
    "src/predicate/ibex_PdcFwdBwd.h",
    "src/predicate/ibex_PdcHansenFeasibility.h",
    "src/predicate/ibex_PdcImageSubset.h",
    "src/predicate/ibex_PdcNo.h",
    "src/predicate/ibex_PdcNot.h",
    "src/predicate/ibex_PdcOr.h",
    "src/predicate/ibex_PdcYes.h",
    "src/set/ibex_Sep.h",
    "src/set/ibex_SepBoundaryCtc.h",
    "src/set/ibex_SepCtcPair.h",
    "src/set/ibex_SepFwdBwd.h",
    "src/set/ibex_SepInter.h",
    "src/set/ibex_SepInverse.h",
    "src/set/ibex_SepNot.h",
    "src/set/ibex_SepQInter.h",
    "src/set/ibex_SepUnion.h",
    "src/set/ibex_Set.h",
    "src/set/ibex_SetBisect.h",
    "src/set/ibex_SetInterval.h",
    "src/set/ibex_SetLeaf.h",
    "src/set/ibex_SetNode.h",
    "src/set/ibex_SetValueNode.h",
    "src/set/ibex_SetVisitor.h",
    "src/strategy/ibex_Backtrackable.h",
    "src/strategy/ibex_Cell.h",
    "src/strategy/ibex_CellBuffer.h",
    "src/strategy/ibex_CellStack.h",
    "src/strategy/ibex_EntailedCtr.h",
    "src/strategy/ibex_Paver.h",
    "src/strategy/ibex_SetImage.h",
    "src/strategy/ibex_Solver.h",
    "src/strategy/ibex_SubPaving.h",
    "src/symbolic/ibex_CmpOp.h",
    "src/symbolic/ibex_Expr.h",
    "src/symbolic/ibex_Expr2DAG.h",
    "src/symbolic/ibex_Expr2Minibex.h",
    "src/symbolic/ibex_ExprCmp.h",
    "src/symbolic/ibex_ExprCopy.h",
    "src/symbolic/ibex_ExprCtr.h",
    "src/symbolic/ibex_ExprDiff.h",
    "src/symbolic/ibex_ExprPrinter.h",
    "src/symbolic/ibex_ExprSimplify.h",
    "src/symbolic/ibex_ExprSize.h",
    "src/symbolic/ibex_ExprSubNodes.h",
    "src/symbolic/ibex_ExprVisitor.h",
    "src/symbolic/ibex_NodeMap.h",
    "src/system/ibex_ExtendedSystem.h",
    "src/system/ibex_FritzJohnCond.h",
    "src/system/ibex_NormalizedSystem.h",
    "src/system/ibex_System.h",
    "src/system/ibex_SystemFactory.h",
    "src/tools/ibex_Agenda.h",
    "src/tools/ibex_Array.h",
    "src/tools/ibex_BitSet.h",
    "src/tools/ibex_DirectedHyperGraph.h",
    "src/tools/ibex_DoubleHeap.h",
    "src/tools/ibex_Exception.h",
    "src/tools/ibex_Heap.h",
    "src/tools/ibex_HyperGraph.h",
    "src/tools/ibex_IntStack.h",
    "src/tools/ibex_Random.h",
    "src/tools/ibex_SharedHeap.h",
    "src/tools/ibex_String.h",
    "src/tools/ibex_SymbolMap.h",
    "src/tools/ibex_Timer.h",
]

IBEX_OPTIM_SRCS = [
    "plugins/optim/src/contractor/ibex_CtcOptimShaving.cpp",
    "plugins/optim/src/contractor/ibex_CtcPolytopeHull.cpp",
    "plugins/optim/src/numeric/ibex_LinearRelax.cpp",
    "plugins/optim/src/numeric/ibex_LinearRelaxCombo.cpp",
    "plugins/optim/src/numeric/ibex_LinearRelaxFixed.cpp",
    "plugins/optim/src/numeric/ibex_LinearRelaxXTaylor.cpp",
    "plugins/optim/src/numeric/ibex_LinearSolver.cpp",
    "plugins/optim/src/strategy/ibex_CellCostFunc.cpp",
    "plugins/optim/src/strategy/ibex_DefaultOptimizer.cpp",
    "plugins/optim/src/strategy/ibex_DefaultSolver.cpp",
    "plugins/optim/src/strategy/ibex_LineSearch.cpp",
    "plugins/optim/src/strategy/ibex_Multipliers.cpp",
    "plugins/optim/src/strategy/ibex_OptimData.cpp",
    "plugins/optim/src/strategy/ibex_Optimizer.cpp",
    "plugins/optim/src/strategy/ibex_StrategyParam.cpp",
    "plugins/optim/src/strategy/ibex_UnconstrainedLocalSearch.cpp",
]

IBEX_OPTIM_HDRS = [
    "plugins/optim/src/strategy/ibex_DefaultStrategy.cpp_",
    "plugins/optim/src/strategy/ibex_OptimProbing.cpp_",
    "plugins/optim/src/strategy/ibex_OptimSimplex.cpp_",
    "plugins/optim/src/contractor/ibex_CtcOptimShaving.h",
    "plugins/optim/src/contractor/ibex_CtcPolytopeHull.h",
    "plugins/optim/src/numeric/ibex_LinearRelax.h",
    "plugins/optim/src/numeric/ibex_LinearRelaxCombo.h",
    "plugins/optim/src/numeric/ibex_LinearRelaxFixed.h",
    "plugins/optim/src/numeric/ibex_LinearRelaxXTaylor.h",
    "plugins/optim/src/numeric/ibex_LinearSolver.h",
    "plugins/optim/src/numeric/ibex_LPException.h",
    "plugins/optim/src/strategy/ibex_CellCostFunc.h",
    "plugins/optim/src/strategy/ibex_CellDoubleHeap.h",
    "plugins/optim/src/strategy/ibex_DefaultOptimizer.h",
    "plugins/optim/src/strategy/ibex_DefaultSolver.h",
    "plugins/optim/src/strategy/ibex_LineSearch.h",
    "plugins/optim/src/strategy/ibex_Multipliers.h",
    "plugins/optim/src/strategy/ibex_OptimData.h",
    "plugins/optim/src/strategy/ibex_Optimizer.h",
    "plugins/optim/src/strategy/ibex_StrategyParam.h",
    "plugins/optim/src/strategy/ibex_UnconstrainedLocalSearch.h",
]

cc_library(
    name = "ibex",
    srcs = IBEX_SRCS + IBEX_OPTIM_SRCS,
    hdrs = IBEX_HDRS + IBEX_OPTIM_HDRS,
    includes = [
        "src/arithmetic",
        "src/bisector",
        "src/combinatorial",
        "src/contractor",
        "src/function",
        "src/numeric",
        "src/parser",
        "src/predicate",
        "src/set",
        "src/strategy",
        "src/symbolic",
        "src/system",
        "src/tools",
        "src/",
        "plugins/optim/src/contractor",
        "plugins/optim/src/numeric",
        "plugins/optim/src/strategy",
    ],
    linkstatic = 1,
    visibility = ["//visibility:public"],
    alwayslink = 1,
    deps = ["@clp//:clp",
            "@filibxx//:filibxx",
    ],
)
